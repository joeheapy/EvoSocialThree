<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simulation Results - EvoSocialThree</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      .results-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .success-banner {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        color: #155724;
      }

      .failure-banner {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        color: #721c24;
      }

      .plot-section {
        background-color: white;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .plot-section h3 {
        color: var(--jrf-purple);
        margin-bottom: 15px;
        font-size: 20px;
      }

      .plot-section img {
        max-width: 100%;
        height: auto;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
      }

      .simulation-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
      }

      .summary-card {
        background-color: #f8f9fa;
        border-radius: 6px;
        padding: 15px;
        text-align: center;
      }

      .summary-card .value {
        font-size: 24px;
        font-weight: 600;
        color: var(--jrf-purple);
        margin-bottom: 5px;
      }

      .summary-card .label {
        font-size: 14px;
        color: var(--jrf-dark-gray);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .download-section {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
      }

      .download-links {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
      }

      .download-link {
        background-color: var(--jrf-blue);
        color: white;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 500;
        transition: background-color 0.3s;
      }

      .download-link:hover {
        background-color: var(--jrf-purple);
        color: white;
      }

      .back-button {
        background-color: var(--jrf-dark-gray);
        color: white;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 500;
        display: inline-block;
        margin-bottom: 20px;
        transition: background-color 0.3s;
      }

      .back-button:hover {
        background-color: var(--jrf-purple);
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="top-bar"></div>
    <header class="header">
      <div class="header-content">
        <a href="/" class="logo"
          ><strong>EvoSocialThree</strong> (Simulation Results)</a
        >
      </div>
    </header>

    <div class="results-container">
      <a href="/" class="back-button">‚Üê Back to Analysis</a>

      {% if g.simulation_result.t_hit is not none %}
      <div class="success-banner">
        <h2 style="margin: 0 0 10px 0">üéØ Target Achieved!</h2>
        <p style="margin: 0; font-size: 16px">
          The target was reached at
          <strong>epoch {{ g.simulation_result.t_hit }}</strong>. Final metric
          value:
          <strong>{{ "%.3f"|format(g.simulation_result.P_series[-1]) }}</strong>
          (Target: {{ "%.3f"|format(g.simulation_params.P_target) }})
        </p>
      </div>
      {% else %}
      <div class="failure-banner">
        <h2 style="margin: 0 0 10px 0">‚è±Ô∏è Maximum Epochs Reached</h2>
        <p style="margin: 0; font-size: 16px">
          Simulation completed {{ g.simulation_params.actual_epochs }} epochs
          without reaching the target. Final metric value:
          <strong>{{ "%.3f"|format(g.simulation_result.P_series[-1]) }}</strong>
          (Target: {{ "%.3f"|format(g.simulation_params.P_target) }})
        </p>
      </div>
      {% endif %}

      <div class="simulation-summary">
        <div class="summary-card">
          <div class="value">
            {{ "%.3f"|format(g.simulation_params.P_baseline) }}
          </div>
          <div class="label">Baseline</div>
        </div>
        <div class="summary-card">
          <div class="value">
            {{ "%.3f"|format(g.simulation_params.P_target) }}
          </div>
          <div class="label">Target</div>
        </div>
        <div class="summary-card">
          <div class="value">{{ g.simulation_params.actual_epochs }}</div>
          <div class="label">Epochs Run</div>
        </div>
        <div class="summary-card">
          <div class="value">{{ g.sector_names|length }}</div>
          <div class="label">Actors</div>
        </div>
      </div>

      <div class="plot-section">
        <h3>Headline Metric Progression</h3>
        <p>
          Shows how the target metric changes over time through the evolutionary
          dynamics.
        </p>
        <img
          src="{{ url_for('static', filename='plots/' + g.simulation_plots.metric_plot) }}"
          alt="Metric progression over time"
        />
      </div>

      <div class="plot-section">
        <h3>Strategy Share Evolution</h3>
        <p>
          Shows how each actor's strategy allocation changes over time.
          Higher-payoff strategies gain larger shares.
        </p>
        <img
          src="{{ url_for('static', filename='plots/' + g.simulation_plots.shares_plot) }}"
          alt="Strategy shares over time"
        />
      </div>

      <div class="plot-section">
        <h3>Payoff Heatmaps</h3>
        <p>
          Shows the relative attractiveness of each strategy over time. Brighter
          colors indicate higher payoffs.
        </p>
        <img
          src="{{ url_for('static', filename='plots/' + g.simulation_plots.payoffs_plot) }}"
          alt="Payoff heatmaps"
        />
      </div>

      <div class="download-section">
        <h3>Download Data</h3>
        <p>Export the simulation results for further analysis:</p>
        <div class="download-links">
          <a
            href="{{ url_for('simulation.download_csv', data_type='shares') }}"
            class="download-link"
          >
            üìä Download Strategy Shares (CSV)
          </a>
          <a
            href="{{ url_for('simulation.download_csv', data_type='payoffs') }}"
            class="download-link"
          >
            üí∞ Download Payoff Data (CSV)
          </a>
        </div>
      </div>
    </div>
  </body>
</html>
